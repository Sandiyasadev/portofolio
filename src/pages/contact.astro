---
import Layout from '../layouts/Layout.astro';
import Icon from '../components/ui/Icon.astro';

const budgetOptions = [
  { value: '', label: 'Select budget range (optional)' },
  { value: '<$500', label: 'Under $500' },
  { value: '$500-$2000', label: '$500 - $2,000' },
  { value: '$2000-$5000', label: '$2,000 - $5,000' },
  { value: '>$5000', label: '$5,000+' },
  { value: 'not-sure', label: 'Not sure yet' }
];

const faqs = [
  {
    question: 'How long does a typical project take?',
    answer: 'Most projects range from 1-4 weeks depending on complexity. Small automations can be done in days, while enterprise-grade workflows may take longer. I\'ll give you a clear timeline during our discovery call.'
  },
  {
    question: 'What if I need changes after the project is done?',
    answer: 'All projects include a 30-day bug fix warranty. For feature changes or enhancements, I offer both one-time updates and managed retainer options.'
  },
  {
    question: 'Do you work with self-hosted n8n or n8n Cloud?',
    answer: 'Both! I can work with your existing setup or help you choose the right option based on your security, scale, and budget requirements.'
  },
  {
    question: 'Can you integrate with custom/internal APIs?',
    answer: 'Absolutely. I\'ve integrated with hundreds of APIs—public and private. If you have API documentation, I can build the integration.'
  }
];
---

<Layout title="Contact | n8n Expert - Let's Talk Automation">
  <!-- Page Header -->
  <section class="page-header">
    <div class="container">
      <span class="badge badge-primary">Contact</span>
      <h1>Let's Talk <span class="gradient-text">Automation</span></h1>
      <p class="page-subtitle">
        Ready to save 10-40 hours per week? Let's discuss your automation needs. 
        No commitment, just clarity on your opportunities.
      </p>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="contact-grid">
        <!-- Contact Form -->
        <div class="contact-form-wrapper">
          <form id="contact-form" class="contact-form" method="POST">
            <div class="form-row">
              <div class="form-group floating">
                <input 
                  type="text" 
                  id="name" 
                  name="name" 
                  placeholder=" "
                  required 
                  autocomplete="name"
                />
                <label for="name">
                  <Icon name="user" size={18} />
                  <span>Your Name</span>
                </label>
                <span class="focus-border"></span>
              </div>

              <div class="form-group floating">
                <input 
                  type="email" 
                  id="email" 
                  name="email" 
                  placeholder=" "
                  required 
                  autocomplete="email"
                />
                <label for="email">
                  <Icon name="mail" size={18} />
                  <span>Email Address</span>
                </label>
                <span class="focus-border"></span>
              </div>
            </div>

            <div class="form-group floating">
              <input 
                type="text" 
                id="company" 
                name="company" 
                placeholder=" "
                autocomplete="organization"
              />
              <label for="company">
                <Icon name="briefcase" size={18} />
                <span>Company (Optional)</span>
              </label>
              <span class="focus-border"></span>
            </div>

            <div class="form-group floating textarea-group">
              <textarea 
                id="use-case" 
                name="use_case" 
                rows="4"
                placeholder=" "
                required
              ></textarea>
              <label for="use-case">
                <Icon name="message-square" size={18} />
                <span>What do you want to automate?</span>
              </label>
              <span class="focus-border"></span>
            </div>

            <div class="form-group select-group">
              <label for="budget">
                <Icon name="credit-card" size={18} />
                <span>Budget Range</span>
              </label>
              <select id="budget" name="budget">
                {budgetOptions.map(option => (
                  <option value={option.value}>{option.label}</option>
                ))}
              </select>
            </div>

            <input type="hidden" name="source" value="contact-page" />
            <input type="hidden" name="timestamp" id="timestamp" value="" />

            <button type="submit" class="btn btn-primary btn-lg submit-btn">
              <span class="btn-text">
                <Icon name="send" size={18} />
                Send Message
              </span>
              <span class="btn-loading">
                <span class="spinner"></span>
                Sending...
              </span>
            </button>

            <p class="form-note">
              <Icon name="shield" size={14} />
              I'll respond within 24 hours. Your information is secure and will never be shared.
            </p>
          </form>

          <div id="form-success" class="form-success" style="display: none;">
            <div class="success-icon">
              <Icon name="check-circle" size={64} />
            </div>
            <h3>Message Sent!</h3>
            <p>Thanks for reaching out. I'll get back to you within 24 hours.</p>
            <a href="/" class="btn btn-secondary">Back to Home</a>
          </div>

          <div id="form-error" class="form-error" style="display: none;">
            <div class="error-icon">
              <Icon name="alert-circle" size={64} />
            </div>
            <h3>Something went wrong</h3>
            <p>Please try again or email me directly at <a href="mailto:hello@example.com">hello@example.com</a></p>
            <button id="retry-btn" class="btn btn-secondary">Try Again</button>
          </div>
        </div>

        <!-- Alternative Channels -->
        <div class="contact-sidebar">
          <div class="sidebar-card">
            <div class="sidebar-icon">
              <Icon name="calendar" size={24} />
            </div>
            <h3>Prefer to Book Directly?</h3>
            <p>Skip the form and schedule a 30-minute discovery call.</p>
            <a 
              href="https://cal.com" 
              target="_blank" 
              rel="noopener noreferrer"
              class="btn btn-primary"
            >
              Open Calendar →
            </a>
          </div>

          <div class="sidebar-card">
            <div class="sidebar-icon">
              <Icon name="message-circle" size={24} />
            </div>
            <h3>Quick Chat?</h3>
            <p>For quick questions, reach out on WhatsApp.</p>
            <a 
              href="https://wa.me/1234567890" 
              target="_blank" 
              rel="noopener noreferrer"
              class="btn btn-secondary"
            >
              WhatsApp →
            </a>
          </div>

          <div class="sidebar-card">
            <div class="sidebar-icon">
              <Icon name="mail" size={24} />
            </div>
            <h3>Email Directly</h3>
            <p>
              <a href="mailto:hello@example.com">hello@example.com</a>
            </p>
          </div>

          <div class="response-time">
            <Icon name="zap" size={20} />
            <span>Average response time: <strong>4 hours</strong></span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ Section -->
  <section class="section section-alt">
    <div class="container">
      <div class="section-header">
        <h2>Frequently <span class="gradient-text">Asked Questions</span></h2>
      </div>

      <div class="faq-list">
        {faqs.map((faq, index) => (
          <details class="faq-item">
            <summary class="faq-question">
              <span>{faq.question}</span>
              <span class="faq-icon">+</span>
            </summary>
            <div class="faq-answer">
              <p>{faq.answer}</p>
            </div>
          </details>
        ))}
      </div>
    </div>
  </section>
</Layout>

<style>
  /* Page Header */
  .page-header {
    padding: var(--space-3xl) 0 var(--space-2xl);
    background: linear-gradient(180deg, var(--color-bg) 0%, var(--color-bg-alt) 100%);
    text-align: center;
  }

  .page-header .badge {
    margin-bottom: var(--space-lg);
  }

  .page-header h1 {
    margin-bottom: var(--space-md);
  }

  .page-subtitle {
    font-size: 1.125rem;
    max-width: 550px;
    margin: 0 auto;
  }

  /* Contact Grid */
  .contact-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-2xl);
  }

  @media (min-width: 1024px) {
    .contact-grid {
      grid-template-columns: 2fr 1fr;
    }
  }

  /* Contact Form */
  .contact-form-wrapper {
    background-color: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    padding: var(--space-xl);
  }

  .contact-form {
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
  }

  /* Form Row */
  .form-row {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-lg);
  }

  @media (min-width: 640px) {
    .form-row {
      grid-template-columns: 1fr 1fr;
    }
  }

  /* Floating Label Form Group */
  .form-group.floating {
    position: relative;
    margin-bottom: var(--space-sm);
  }

  .form-group.floating input,
  .form-group.floating textarea {
    width: 100%;
    padding: 1.25rem 1rem 0.5rem 2.75rem;
    background-color: var(--color-bg);
    border: 2px solid var(--color-border);
    border-radius: var(--radius-lg);
    font-size: 1rem;
    font-family: inherit;
    color: var(--color-text);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    outline: none;
  }

  .form-group.floating input:hover,
  .form-group.floating textarea:hover {
    border-color: var(--color-text-muted);
  }

  .form-group.floating input:focus,
  .form-group.floating textarea:focus {
    border-color: var(--color-primary);
    box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
  }

  .form-group.floating label {
    position: absolute;
    left: 2.75rem;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    font-size: 0.9375rem;
    font-weight: 500;
    color: var(--color-text-muted);
    pointer-events: none;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .form-group.floating label :global(.icon) {
    position: absolute;
    left: -1.75rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .form-group.floating input:focus + label,
  .form-group.floating input:not(:placeholder-shown) + label {
    top: 0.5rem;
    transform: translateY(0);
    font-size: 0.75rem;
    color: var(--color-primary);
  }

  .form-group.floating input:focus + label :global(.icon),
  .form-group.floating input:not(:placeholder-shown) + label :global(.icon) {
    color: var(--color-primary);
  }

  /* Textarea specific */
  .form-group.textarea-group label {
    top: 1.25rem;
    transform: translateY(0);
  }

  .form-group.textarea-group textarea:focus + label,
  .form-group.textarea-group textarea:not(:placeholder-shown) + label {
    top: 0.5rem;
    font-size: 0.75rem;
    color: var(--color-primary);
  }

  .form-group.textarea-group textarea:focus + label :global(.icon),
  .form-group.textarea-group textarea:not(:placeholder-shown) + label :global(.icon) {
    color: var(--color-primary);
  }

  .form-group.floating textarea {
    min-height: 120px;
    resize: vertical;
    padding-top: 1.5rem;
  }

  /* Focus Border Animation */
  .form-group.floating .focus-border {
    position: absolute;
    bottom: 0;
    left: 50%;
    width: 0;
    height: 2px;
    background: linear-gradient(135deg, var(--color-primary) 0%, #06b6d4 100%);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border-radius: 0 0 var(--radius-lg) var(--radius-lg);
  }

  .form-group.floating input:focus ~ .focus-border,
  .form-group.floating textarea:focus ~ .focus-border {
    left: 0;
    width: 100%;
  }

  /* Select Group */
  .form-group.select-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
  }

  .form-group.select-group label {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--color-text-muted);
  }

  .form-group.select-group select {
    width: 100%;
    padding: var(--space-md) var(--space-lg);
    background-color: var(--color-bg);
    border: 2px solid var(--color-border);
    border-radius: var(--radius-lg);
    font-size: 1rem;
    font-family: inherit;
    color: var(--color-text);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    outline: none;
  }

  .form-group.select-group select:hover {
    border-color: var(--color-text-muted);
  }

  .form-group.select-group select:focus {
    border-color: var(--color-primary);
    box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
  }

  /* Submit Button */
  .submit-btn {
    width: 100%;
    position: relative;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .submit-btn .btn-text {
    display: inline-flex;
    align-items: center;
    gap: var(--space-sm);
    transition: all 0.3s ease;
  }

  .submit-btn .btn-loading {
    display: none;
    align-items: center;
    gap: var(--space-sm);
  }

  .submit-btn.loading .btn-text {
    display: none;
  }

  .submit-btn.loading .btn-loading {
    display: inline-flex;
  }

  .submit-btn:hover:not(:disabled) {
    transform: translateY(-2px);
  }

  .submit-btn:active:not(:disabled) {
    transform: translateY(0);
  }

  .submit-btn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
  }

  /* Spinner Animation */
  .spinner {
    width: 18px;
    height: 18px;
    border: 2px solid transparent;
    border-top-color: currentColor;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  .form-note {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-xs);
    font-size: 0.8125rem;
    text-align: center;
    margin: 0;
    color: var(--color-text-muted);
  }

  /* Form States */
  .form-success,
  .form-error {
    text-align: center;
    padding: var(--space-2xl);
  }

  .success-icon,
  .error-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 80px;
    height: 80px;
    margin: 0 auto var(--space-md);
  }

  .success-icon {
    color: var(--color-success);
  }

  .error-icon {
    color: var(--color-error);
  }

  .form-success h3,
  .form-error h3 {
    margin-bottom: var(--space-sm);
  }

  .form-success p,
  .form-error p {
    margin-bottom: var(--space-lg);
  }

  /* Sidebar */
  .contact-sidebar {
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
  }

  .sidebar-card {
    background-color: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--space-lg);
  }

  .sidebar-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(6, 182, 212, 0.1) 100%);
    border-radius: var(--radius-lg);
    color: var(--color-primary);
    margin-bottom: var(--space-md);
  }

  .sidebar-card h3 {
    font-size: 1rem;
    margin-bottom: var(--space-sm);
  }

  .sidebar-card p {
    font-size: 0.875rem;
    margin-bottom: var(--space-md);
  }

  .sidebar-card p:last-child {
    margin-bottom: 0;
  }

  .response-time {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-md);
    background-color: rgba(16, 185, 129, 0.1);
    border-radius: var(--radius-md);
    font-size: 0.875rem;
    color: var(--color-success);
  }

  /* FAQ Section */
  .faq-list {
    max-width: 800px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
  }

  .faq-item {
    background-color: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    overflow: hidden;
  }

  .faq-question {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-lg);
    cursor: pointer;
    font-weight: 600;
    list-style: none;
  }

  .faq-question::-webkit-details-marker {
    display: none;
  }

  .faq-icon {
    font-size: 1.25rem;
    color: var(--color-primary);
    transition: transform var(--transition-fast);
  }

  .faq-item[open] .faq-icon {
    transform: rotate(45deg);
  }

  .faq-answer {
    padding: 0 var(--space-lg) var(--space-lg);
  }

  .faq-answer p {
    margin: 0;
    font-size: 0.9375rem;
  }
</style>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const formSuccess = document.getElementById('form-success');
  const formError = document.getElementById('form-error');
  const retryBtn = document.getElementById('retry-btn');
  const timestampField = document.getElementById('timestamp') as HTMLInputElement;

  // Set timestamp on page load
  timestampField.value = new Date().toISOString();

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const submitBtn = form.querySelector('.submit-btn') as HTMLButtonElement;

    // Show loading state
    submitBtn.disabled = true;
    submitBtn.classList.add('loading');

    try {
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      // Send to n8n webhook
      // Replace with your actual n8n webhook URL
      const webhookUrl = 'https://your-n8n-instance.com/webhook/lead-contact';
      
      const response = await fetch(webhookUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      });

      if (!response.ok) throw new Error('Failed to submit');

      // Track analytics event
      if (typeof window !== 'undefined' && (window as any).gtag) {
        (window as any).gtag('event', 'submit_form_contact', {
          'event_category': 'lead',
          'event_label': data.use_case
        });
      }

      // Show success
      form.style.display = 'none';
      formSuccess!.style.display = 'block';
    } catch (error) {
      console.error('Form submission error:', error);
      form.style.display = 'none';
      formError!.style.display = 'block';
    } finally {
      submitBtn.disabled = false;
      submitBtn.classList.remove('loading');
    }
  });

  retryBtn?.addEventListener('click', () => {
    formError!.style.display = 'none';
    form!.style.display = 'flex';
  });
</script>
